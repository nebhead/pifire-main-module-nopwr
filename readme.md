# PiFire Main Module PCB (v4.x.x) KiCad Files

![](/img/board.jpg)

## What is this? 

This PCB provides a modular approach to building your PiFire Smart Smoker Controller.  This board breaks out the many interfaces that are commonly used to support sensors, relays, displays and other devices.  This design allows the user to choose features that suit their needs such as using a PWM DC Fan instead of the AC fan system, or allows for different and expanded probe devices.  Some other notable features are the addition of a 1-Wire bus connector, a wake/shutdown option, and more!  

__Important Notes:__  
1. This board requires v1.8.x of PiFire or later.  As of May 2024, this version is still in development and can be tested by switching to the development branch in the updater page.  Ensure you run through the configuration wizard to select the v4.x.x board and configure your specific settings appropriately. 
1. This board does NOT support the selector switch to run in parallel with the OEM controller.  The pin used for this purpose has been repurposed for the wake/shutdown feature. 

The design intent for this board was to make a DIY accessible PCB that can be more easily put together by the maker/enthusiast of almost any skill level.  Full size components are used in most cases and most (if not all) parts should be readily available to order online.  See the [Interactive BOM](#interactive-bom) for more details about the parts used and links to order.

### What is PiFire? 

PiFire is a SBC based Pellet Smoker Controller.  More details can be found [here](https://nebhead.github.io/PiFire) or [at the GitHub repo](https://github.com/nebhead/pifire). 

## What's in this Repository?

### KiCad Project Files 
In this repository you will find the latest KiCad design files for the  PCB.  Simply load the project file (.kicad_pro) into the KiCad software and you should be able to edit as needed.  Or if you just want to get this board made, jump to the production section below.

### Interactive BOM

There is an interactive BOM located in the [/bom](bom/) folder which details the parts and provides some pin information as well.  Use this to gather the components you may need to build this board out and refer back to it for placement help.    

[BOM + Pin Info](https://nebhead.github.io/pifire-main-module-nopwr)

_This is a standalone HTML file that was autogenerated by the excellent plugin for KiCad. See the plugin here: [https://github.com/openscopeproject/InteractiveHtmlBom](https://github.com/openscopeproject/InteractiveHtmlBom)_

### PDF of the Schematic

Preview the schematic in PDF format here: [Schematic](schematic.pdf)

![Schematic PNG](/img/schematic.png)

### JLCPCB Production Files

If you wish to get these PCBs made by JLCPCB, the production files are provided in the `/production` folder.  For convenience, the file `production.zip` can simply be uploaded to JLCPCB to make it super easy to order boards.

Drop the zip file onto the order page, wait for it to upload then simply continue to order the board.  Optionally, select different board color, PCB quantity, surface finish, etc.  Most of the default settings should be sufficient. 

![JLCPCB Order Page](/img/jlcpcb.png)

### Links to the PCBs in this family of PiFire Boards

This PCB is part of a family of PCBs that can be used together to create  a full PiFire system.  Generally speaking you need the Main Module/Board, a Relay Control Board and a Probe Device board to have a basic PiFire system.  

**Main Module/Board** (required)
* [Main Board v4.0.x](https://github.com/nebhead/pifire-main-module-nopwr)

**Relay/Fan Control Boards** (choose one)
* [Mechanical Relay Module](https://github.com/nebhead/pifire-relay-module)
* [Solid State Relay Module](https://github.com/nebhead/pifire-relay-module-SSR)
* [Solid State Relay + PWM Fan Module](https://github.com/nebhead/pifire-relay-pwm-module-ssr) - Original Design
* [Solid State Relay + PWM Fan Module Alternate](https://github.com/nebhead/pifire-relay-pwm-module-ssr-alt) - Updated Design (Designed with help from @labmonkeyrat on Discord)

**Probe Device Board** (optional)
* [ADS Board](https://github.com/nebhead/pifire-ads-board) 

### General 4.x.x PCB Architecture

Sometimes it is easier to understand how a project is built out by looking at the general architecture.  I've created a high-level diagram of the project so that you can get an idea of how all of this should be connected up. 

The first diagram is of the AC Fan Version of the system.  This version only requires a 5V power supply and only uses a portion of the headers to connect to a relay board.  Technically speaking, in this configuration you could use an off the shelf relay board if you wanted to wire this up yourself.

![PCB 4.x.x Diagram AC Fan](/img/PiFire-PCB-v4-Diagram.jpg)

The second diagram is of the DC PWM Fan version of the system.  You'll notice that this version utilizes a 5V/12V power-supply and the specially design relay/PWM Fan board.  

![PCB 4.x.x Diagram DC Fan](/img/PiFire-PCB-v4-Diagram-PWM.jpg)

### PCB 4.x.x Pinout

Due to space constraints on the PCB silkscreen layer, most of the pins for the JST connectors are unmarked.  Thus I'm providing a handy set of images for the pinout of the major unmarked JST connectors. 

___Buttons & Encoder Header___

![PCB 4.x.x Pinout Buttons](/img/PiFire-PCB-v4-Pinout-Buttons.jpg)

___1-Wire Header___ - _Used for the DS18B20 reference probe.  Great for using as a reference to tune your other probes._

![PCB 4.x.x Pinout 1-Wire](/img/PiFire-PCB-v4-Pinout-1Wire.jpg)

___Relay and PWM Fan Headers___ - _If you are not using the DC Fan, then only the top header needs to be populated._

![PCB 4.x.x Pinout Relay / Fan](/img/PiFire-PCB-v4-Pinout-Relay-Fan.jpg)

___Auxiliary SPI Header___ - _If you are already using the display SPI header, this can be used for another SPI based device such as the MAX38165 RTD probe device._

```note
You must bridge solder jumpers on the back the board to select Chip Enable 0, Chip Enable 1 or GPIO6 (CE0/CE1/GPIO6) and 3.3V or 5V.  Do not bridge both 3.3V and 5V or CE0 and CE1 at the same time or you may damage your system.
```

![PCB 4.x.x Pinout Auxiliary SPI](/img/PiFire-PCB-v4-Pinout-SPI-AUX.jpg)

___Display SPI Header___ - _If you are using a SPI based display like the ILI9341, then this header should match the pinout for that display._

```note
You must bridge solder jumpers on the back the board to select Chip Enable 0 or 1 (CE0/CE1) and 3.3V or 5V.  Do not bridge both 3.3V and 5V or CE0 and CE1 at the same time or you may damage your system.
```

![PCB 4.x.x Pinout Display SPI](/img/PiFire-PCB-v4-Pinout-SPI-Display.jpg)

___I2C Headers___ - _All of the I2C headers pinouts are identical and can be used for any of the I2C devices including the ADC board, an I2C display, or an I2C distance device._


### 3D Printable Enclosures/Boxes 

With all of the 3D Prints for PiFire, a higher temperature filament such as PETG should be used.  PLA generally won't stand up to the temperatures that the components may be exposed to outdoors and near a hot smoker.  

#### Pi Zero W/2W Enclosure

An initial revision of the enclosure for this, supporting the Raspberry Pi Zero W/2W (and may actually also support the Raspberry Pi 3A+ but has not been tested).  The current models should be considered still in development and may have alignment challenges, etc. 

Except for the mounting wings and the Raspberry Pi mounts, the majority of bolts to be used with this enclosure are M3. 

![Pi Zero Enclosure](/img/PiFire-PCB-v4-PiZero-Enclosure.png)

* STL: [Base](/printables/PiFire-v4-PiZero-Base.stl)
* STL: [Lid](/printables/PiFire-v4-PiZero-Lid.stl)
* OnShape: [Enclosure Original Models](https://cad.onshape.com/documents/3596921e7143afe3464ba577/w/28c0bdfc90c946dc2a56d7d1/e/2ad9de1bc228faf5a8cd0384?renderMode=0&uiState=66e0db844db84570fca6f1d5)

